---
title: Redis 事务
description: Redis
date: 2020-01-01 00:00:00 +08:00
tags: Redis
category: Redis
---

# Redis事务

在 Redis 中，也存在多个客户端同时向 Redis 系统发送命令的并发可能性，因此同一个数据，可能在不同的时刻被不同的线程所操纵，这样就出现了并发下的数据一致的问题。为了保证异性数据的安全性，Redis 为提供了事务方案。而 Redis 的事务是使用 MULTI-EXEC 的命令组合，使用它可以提供两个重要的保证：
- 事务是一个被隔离的操作，事务中的方法都会被 Redis 进行序列化并按顺序执行，事务在执行的过程中不会被其他客户端发生的命令所打断。
- 事务是一个原子性的操作，它要么全部执行，要么就什么都不执行。

在 Redis 中使用事务会经过 3 个过程：
- 开启事务。
- 命令进入队列。
- 执行事务。

## Redis事务命令

命令 | 说明 | 备注
- | - | -
multi | 开启事务命令，之后的命令就进入队列，而不会马上被执行 | 在事务生存期间，所有的 Redis 关于数据结构的命令都会入队
watch key1 [key2......] | 监听某些键，当被监听的键在事务执行前被修改，则事务会被回滚 | 使用乐观锁
unwatch key1 [key2......]  | 取消监听某些键 | ——
exec | 执行事务，如果被监听的键没有被修改，则采用执行命令，否则就回滚命令 | 在执行事务队列存储的命令前，Redis 会检测被监听的键值对有没有发生变化，如果没有则执行命令, 否则就回滚事务
discard | 回滚事务 | 回滚进入队列的事务命令，之后就不能再用 exec 命令提交了

## Redis事务回滚
执行事务命令的时，当命令入队，Redis 就会检测事务的命令是否正确，如果不正确则会产生错误。无论之前和之后的命令都会被事务所回滚，就变为什么都没有执行。


## Redis监控事务
使用 watch 命令可以决定事务是执行还是回滚

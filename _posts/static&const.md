---
title: static与const 关键字
description: C++
date: 2020-01-05 00:00:00 +08:00
tags: C++
category: C++
---

# static关键字
## static 的作用
    规定存储方式和作用域  

## static 关键字修饰变量/函数
- static 全局变量  
    全局静态变量, 保存在静态存储区, 不初始化自动初始化0, 作用域本文件   

- static 局部变量  
    局部静态变量, 保存在静态存储区, 不初始化自动初始化0, 作用域本文件  

- static 函数  
    1、在函数返回类型前加static，函数就定义为静态函数。函数的定义和声明在默认情况下都是extern的，但静态函数只是在声明他的文件当中可见，不能被其他文件所用   
    2、函数的实现使用static修饰，那么这个函数只可在本cpp内使用，不会同其他cpp中的同名函数引起冲突   

- static 类成员变量  
    1、类静态成员可以实现多个对象之间的数据共享，静态成员是类的所有对象中共享的成员,而不是某个对象的成员。  
    2、使用静态数据成员还不会破坏隐藏的原则，即保证了安全性。  
    3、对多个对象来说，静态数据成员只存储一处，供所有对象共用。  
    4、静态成员变量的生命期不依赖于任何对象，为程序的生命周期  
    5、可以通过类名直接访问公有静态成员变量, 可以通过对象名访问公有静态成员变量  
    6、静态成员变量在类外单独分配空间   
    7、静态成员变量在程序内部位于全局数据区 

- static 类成员函数  
    1、属于类的静态成员，不是对象成员   
    2、实现中不能直接引用类中说明的非静态成员，可以引用类中说明的静态成员(出现"对非静态成员的非法引用")
    3、静态成员函数中要引用非静态成员时，可通过对象来引用

# const 关键字  
不可为左值, 规定只读(不可更改)，在声明中使用

- const 常量
    定义时就必须进行初始化，以后不能更改。
- const 形参  
    func(const int a){};该形参在函数里不能改变
- const 修饰类成员变量  
    构造函数对该数据成员赋值，任何函数不能对该成员变量赋值，
- const 修饰类成员函数  
    该函数对成员变量只能进行只读操作，不能更新值
- const 引用
    常引用所引用的对象不能被更新, 作为形参传入时，调用函数中不修改其值，如果是对象，减少调用构造函数。拷贝构造参数使用常引用

# 常量指针与指针常量
const char \*p 和char const \*p都表示 指向的内容不能改变。

char \* const p，就是将P声明为常指针，它的地址不能改变，是固定的，但是它的内容可以改变。

主要看const 和"\*"的位置   
const在"\*"左侧，修饰的是指针指向的内存数据，内存数据不能被改变  
const在"\*"右侧，修饰的是指针，指针不能被改变  

    ``` c++
    int na = 2;
    const int *p1 = &na;
    *p1 = 1; // 编译报错 error C3892: “p1”: 不能给常量赋值 
    ```

    ``` c++
    int na = 2;
    int * const p2 = &na;
	*p2++; // 编译报错 error C3892: “p2”: 不能给常量赋值
    ```

    ``` c++
    int na = 2;
    const int * const p3 = &na;
    *p3++;  // 编译报错 error C3892: “p3”: 不能给常量赋值
    *p3 = 1; // 编译报错 error C3892: “p3”: 不能给常量赋值
    ```

# const 和 static 一起用
const static 和 static const 一样
``` c++
void func1()
{
    const int a1 = 6;
    int * pa = const_cast<int*>(&a1);
    cout << ++*pa << endl; // 没问题
}

void func2()
{
    const static int a2 = 6;
    int * paa = const_cast<int*>(&a2);
    cout << ++*paa << endl; // 编译可以过，但运行时引发了异常: 写入访问权限冲突。
}
```
TODO 和static有关 查看了汇编，还是有点问题
![](https://raw.githubusercontent.com/huobingli/huobingli.github.io/master/img/static_cast.png)
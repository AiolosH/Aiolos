---
title: 哈希算法
description: 数据结构
date: 2020-01-01 00:00:00 +08:00
tags: 数据结构
category: 数据结构
---

# 哈希算法
哈希算法： 将<font color="red">任意长度</font>的二进制值串映射为<font color="red">固定长度</font>的二进制值串  
哈希值： 通过原始数据映射之后得到的二进制值串

要求
- 从哈希值不能反向推导出原始数据（所以哈希算法也叫单向哈希算法）
- 对输入数据非常敏感，哪怕原始数据只修改了一个 Bit，最后得到的哈希值也大不相同
- 散列冲突的概率要很小，对于不同的原始数据，哈希值相同的概率非常小
- 哈希算法的执行效率要尽量高效，针对较长的文本，也能快速地计算出哈希值

## 为啥不能避免哈希冲突
    鸽巢原理 10个鸽巢，11个鸽子，肯定有一个鸽巢里有两个鸽子。

## 哈希算法应用

- 安全加密  
    MD5（MD5 Message-Digest Algorithm，MD5 消息摘要算法）, SHA（Secure Hash Algorithm，安全散列算法）, DES（Data Encryption Standard，数据加密标准）, AES（Advanced Encryption Standard，高级加密标准）
    
    加盐加密

- 唯一标识   
    <b>通过哈希算法计算出数据的唯一标识，从而用于高效检索数据。</b>   

    在图库中搜索图片。可以给每一个图片取一个唯一标识，或者说信息摘要。比如，我们可以从图片的二进制码串开头取 100 个字节，从中间取 100 个字节，从最后再取 100 个字节，然后将这 300 个字节放到一块，通过哈希算法（比如 MD5），得到一个哈希字符串，用它作为图片的唯一标识。通过这个唯一标识来判定图片是否在图库中，这样就可以减少很多工作量。

- 数据校验   
    <b>利用哈希算法对输入数据敏感的特点，可以对数据取哈希值，从而高效校验数据是否被篡改过。</b>

    BT 下载软件 基于 P2P 协议。   
    从多个机器上并行下载一个 2GB 的电影，这个电影文件可能会被分割成很多文件块（比如可以分成 100 块，每块大约 20MB）。等所有的文件块都下载完成之后，再组装成一个完整的电影文件就行了。

    这里的下载块可能被篡改过，或者下在过程中出错，导致下载的文件块不完整。可以通过哈希算法对这些文件块计算哈希值，然后存在种子文件中。   
    当文件块下载完成之后，我们可以通过相同的哈希算法，对下载好的文件块逐一求哈希值，然后跟种子文件中保存的哈希值比对。如果不同，说明这个文件块不完整或者被篡改了，需要再重新从其他宿主机器上下载这个文件块。

- 散列函数  
    <b>散列函数对于散列算法计算得到的值，是否能反向解密也并不关心，更关注是否平均分布</b>

- 负载均衡  
    我们可以通过哈希算法，对客户端 IP 地址或者会话 ID 计算哈希值，将取得的哈希值与服务器列表的大小进行取模运算，最终得到的值就是应该被路由到的服务器编号。

- 数据分片  
1、统计关键词  
    我们可以先对数据进行分片，然后采用多台机器处理的方法，来提高处理速度   
2、快速判断图片是否在图库中
    对数据进行分片，采用多机处理，每台机器维护部分图片的散列表。   
    每次从图库中读取一个图片，计算唯一标识，然后与机器个数 n 求余取模，得到的值就对应要分配的机器编号，然后将这个图片的唯一标识和图片路径发往对应的机器构建散列表，直到构建完图库中的所有图片。

    对于需要判断的图片，计算唯一标识，然后与机器个数 n 求余取模，去结果的机器编号中寻找。

- 分布式存储
    通过哈希算法对数据取哈希值，然后对机器个数取模，这个最终值就是应该存储的缓存机器编号。

    如果数据量增多，需要增加机器时（扩容），并不是简单的增加机器。
    ![](https://raw.githubusercontent.com/huobingli/huobingli.github.io/master/img/hash_distributed.png)

    直接增加机器，会导致<font color="red">所有的哈希值重新计算</font>，导致原来的缓存失效，所有数据请求穿透缓存，直接请求数据库，可能发生雪崩效应，压垮数据库。

    就需要一致性哈希算法。
## 一致性哈希算法

假设我们有 k 个机器，数据的哈希值的范围是[0, MAX]。我们将整个范围划分成 m 个小区间（m 远大于 k），每个机器负责 m/k 个小区间。当有新机器加入的时候，我们就将某几个小区间的数据，从原来的机器中搬移到新的机器中。这样，既不用全部重新哈希、搬移数据，也保持了各个机器上数据数量的均衡

可以解决缓存等分布式系统的扩容、缩容导致数据大量搬移的难题。


## 加盐(salt)加密

盐（salt）跟用户的密码组合在一起，增加密码的复杂度。我们拿组合之后的字符串来做哈希算法加密，将它存储到数据库中，进一步增加破解的难度